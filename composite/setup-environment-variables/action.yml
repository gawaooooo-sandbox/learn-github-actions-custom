name: Setup Environment Variables
description: |
  This action sets up environment variables for the project.
  Set environment variables using a space-separated string.
  For example, 'TEST="abc" URL="http://agalkjgaljgalkjglag" SEPARATED_VALUE="abc def"'

inputs:
  environment-variables:
    description: |
      Required input to set the environment variables.
      Environment variables as a space-separated string (e.g., 'TEST="abc" URL="http://example.com" SERVICE="app"')
    required: true

runs:
  using: "composite"
  steps:
    - name: Validate and Set Environment Variables
      run: |
        set -x
        set -e

        # env_vars="${{ inputs.environment-variables }}"
        env_vars='${{ inputs.environment-variables }}'
        echo "$env_vars"


        # 正規表現を使ってクォートで囲まれた部分を抽出し、正しく処理
        while [[ "$env_vars" =~ ([A-Za-z_][A-Za-z_0-9]*="[^"]*") ]]; do
          var="${BASH_REMATCH[1]}"
          # 抽出した変数を設定
          key=$(echo "$var" | cut -d '=' -f 1)
          value=$(echo "$var" | sed -e 's/^[^=]*="//' -e 's/"$//')
          echo "Setting: $key=$value"
          echo "$key=$value" >> "$GITHUB_ENV"
          # 処理した変数部分を削除して次の変数へ
          env_vars=${env_vars#*$var}
        done
      shell: bash
